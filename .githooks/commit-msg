#!/bin/bash
# Git hook to enforce task ID in commit messages

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Read the commit message
commit_message=$(cat "$1")

# Define the regex pattern for task IDs
# Matches: [INF-XXX], [BE-XXX], [FE-XXX], [ALL-XXX] at the start of the message
commit_regex='^\[(INF|BE|FE|ALL)-[0-9]+\]'

# Check if commit message matches the pattern
if echo "$commit_message" | grep -qE "$commit_regex"; then
    echo -e "${GREEN}✓ Commit message includes task ID${NC}"
    exit 0
else
    echo -e "${RED}✗ Commit message must start with a task ID${NC}"
    echo -e "${YELLOW}Example formats:${NC}"
    echo "  [INF-001] Set up GCP project"
    echo "  [BE-005] Create health check endpoint"
    echo "  [FE-003] Add loading component"
    echo "  [ALL-001] Update documentation"
    echo ""
    echo -e "${YELLOW}Your message:${NC} $commit_message"
    echo ""
    echo -e "${YELLOW}Tip:${NC} Check /claude/project-management-plan.md for task IDs"
    exit 1
fi